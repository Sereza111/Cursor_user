<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öú –°–µ—Å—Å–∏—è #<%= session.id %></title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="/" class="navbar-brand">
            ‚öú CURSOR REGISTER
        </a>
        <div class="navbar-nav">
            <a href="/" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/sessions" class="nav-link">–ò—Å—Ç–æ—Ä–∏—è</a>
            <a href="/logout" class="nav-link">–í—ã—Ö–æ–¥</a>
        </div>
    </nav>

    <div class="container">
        <div class="main-card">
            <!-- Session Header -->
            <div class="session-header">
                <div>
                    <h1>üìú –°–µ—Å—Å–∏—è #<%= session.id %></h1>
                    <p class="subtitle">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏</p>
                </div>
                <a href="/sessions" class="btn btn-primary">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                </a>
            </div>

            <div class="divider"></div>

            <!-- Session Info -->
            <div class="session-info mb-3">
                <div class="session-info-item">
                    <span class="session-info-label">–†–µ–∂–∏–º</span>
                    <span class="session-info-value">
                        <%= session.mode === 'register' ? 'üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' : 'üîë –í—Ö–æ–¥' %>
                    </span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">–°—Ç–∞—Ç—É—Å</span>
                    <span class="session-info-value">
                        <% if (session.status === 'completed') { %>
                            <span class="status-badge status-success">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                        <% } else if (session.status === 'running') { %>
                            <span class="status-badge status-processing">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
                        <% } else { %>
                            <span class="status-badge status-pending"><%= session.status %></span>
                        <% } %>
                    </span>
                </div>
                <div class="session-info-item">
                    <span class="session-info-label">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</span>
                    <span class="session-info-value"><%= new Date(session.created_at).toLocaleString('ru-RU') %></span>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number"><%= session.total_accounts %></span>
                    <span class="stat-label">–í—Å–µ–≥–æ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number"><%= session.processed_accounts %></span>
                    <span class="stat-label">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number text-success"><%= session.success_count %></span>
                    <span class="stat-label">–£—Å–ø–µ—à–Ω–æ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number text-danger"><%= session.failed_count %></span>
                    <span class="stat-label">–û—à–∏–±–æ–∫</span>
                </div>
            </div>

            <div class="ornament">‚ú† ‚ú† ‚ú†</div>

            <!-- Accounts Table -->
            <h3 class="mb-2">üìã –ê–∫–∫–∞—É–Ω—Ç—ã —Å–µ—Å—Å–∏–∏</h3>
            <div class="table-container">
                <table class="gothic-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Email</th>
                            <th>–ò–º—è</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>Trial</th>
                            <th>–ü—Ä–æ–∫—Å–∏</th>
                            <th>–û—à–∏–±–∫–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% accounts.forEach((acc, index) => { %>
                            <tr class="slide-in" style="animation-delay: <%= index * 0.05 %>s">
                                <td><%= index + 1 %></td>
                                <td><%= acc.email %></td>
                                <td><%= acc.full_name || '-' %></td>
                                <td>
                                    <% if (acc.status === 'success') { %>
                                        <span class="status-badge status-success">‚úì –£—Å–ø–µ—Ö</span>
                                    <% } else if (acc.status === 'failed') { %>
                                        <span class="status-badge status-failed">‚úï –û—à–∏–±–∫–∞</span>
                                    <% } else if (acc.status === 'processing') { %>
                                        <span class="status-badge status-processing">‚ü≥ –û–±—Ä–∞–±–æ—Ç–∫–∞</span>
                                    <% } else { %>
                                        <span class="status-badge status-pending">‚óå –û–∂–∏–¥–∞–Ω–∏–µ</span>
                                    <% } %>
                                </td>
                                <td>
                                    <% if (acc.trial_status === 'active') { %>
                                        <span class="text-success">‚úì <%= acc.trial_days || 7 %> –¥–Ω–µ–π</span>
                                    <% } else if (acc.trial_status === 'pending_verification') { %>
                                        <span class="text-muted">‚ßó –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è</span>
                                    <% } else if (acc.trial_status === 'none') { %>
                                        <span class="text-muted">‚Äî</span>
                                    <% } else { %>
                                        <span class="text-muted">?</span>
                                    <% } %>
                                </td>
                                <td><%= acc.proxy_used || 'direct' %></td>
                                <td class="text-danger" style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                                    <%= acc.error_message || '-' %>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>

            <!-- Export buttons -->
            <div class="d-flex gap-2 mt-2">
                <a href="/api/sessions/<%= session.id %>/export?format=csv" class="btn btn-primary">
                    üìÑ –≠–∫—Å–ø–æ—Ä—Ç CSV
                </a>
                <a href="/api/sessions/<%= session.id %>/export?format=txt" class="btn btn-primary">
                    üìù –≠–∫—Å–ø–æ—Ä—Ç TXT
                </a>
                <a href="/api/sessions/<%= session.id %>/export?format=csv&filter=success" class="btn btn-success">
                    ‚úì –¢–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ
                </a>
            </div>

            <div class="divider"></div>

            <!-- Logs -->
            <h3 class="mb-2">üìã –õ–æ–≥–∏ —Å–µ—Å—Å–∏–∏</h3>
            <div class="log-container">
                <% logs.forEach(log => { %>
                    <div class="log-entry">
                        <span class="log-time"><%= new Date(log.created_at).toLocaleTimeString('ru-RU') %></span>
                        <span class="log-level <%= log.level %>">
                            <% if (log.level === 'info') { %>‚ÑπÔ∏è<% } %>
                            <% if (log.level === 'warning') { %>‚ö†Ô∏è<% } %>
                            <% if (log.level === 'error') { %>‚ùå<% } %>
                            <% if (log.level === 'success') { %>‚úÖ<% } %>
                        </span>
                        <span class="log-message"><%= log.message %></span>
                    </div>
                <% }) %>
                <% if (logs.length === 0) { %>
                    <div class="log-entry">
                        <span class="log-message text-muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥–µ</span>
                    </div>
                <% } %>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-muted" style="padding: 20px;">
            <p class="ornament">‚öú ‚öú ‚öú</p>
            <p>Cursor Mass Register Panel v1.0</p>
        </div>
    </div>
</body>
</html>
